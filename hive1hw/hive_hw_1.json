{"paragraphs":[{"config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":true,"keys":[{"name":"t.date","index":0,"aggr":"sum"}],"values":[{"name":"_c1","index":1,"aggr":"sum"},{"name":"_c2","index":2,"aggr":"sum"},{"name":"_c3","index":3,"aggr":"sum"},{"name":"_c4","index":4,"aggr":"sum"},{"name":"_c5","index":5,"aggr":"sum"}],"groups":[],"scatter":{"xAxis":{"name":"t.date","index":0,"aggr":"sum"},"yAxis":{"name":"_c1","index":1,"aggr":"sum"}}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1460915245910_1691945389","id":"20160417-104725_1431124148","dateCreated":"Apr 17, 2016 10:47:25 AM","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:826","text":"%hive\nwith tmp as (\n  SELECT \n    cast(from_unixtime(unix_timestamp(s.time,'yyyyMMddHHmmssSSS'), 'yyyy-MM-dd') AS date) AS date, \n    s.i_pin_you_id as id \n  FROM stream s \n    where s.stream_id = 11\n    group by from_unixtime(unix_timestamp(s.time, 'yyyyMMddHHmmssSSS'), 'yyyy-MM-dd'), s.i_pin_you_id),\n        \ntmp_new as (select tf.date as date, tf.id as id, count(*) over (partition by tf.id order by tf.date rows UNBOUNDED PRECEDING) as first from tmp tf),\n\ntmp_cr as (select tf.date as date, tf.id as id, count(*) over (partition by tf.id order by tf.date rows UNBOUNDED PRECEDING) as first from tmp tf),\n\ntmp_chr as (select tf.date as date, tf.id as id, count(*) over (partition by tf.id order by tf.date rows UNBOUNDED PRECEDING) as first from tmp tf),\n\ntmp_ar as (select tf.date as date, tf.id as id, count(*) over (partition by tf.id order by tf.date rows 3 PRECEDING) as first from tmp tf),\n\ntmp_arr as (select tf.date as date, tf.id as id, count(*) over (partition by tf.id order by tf.date rows 3 PRECEDING) as first from tmp tf),\n\ntmp_l as (select tf.date as date, tf.id as id, count(*) over (partition by tf.id order by tf.date rows between 3 PRECEDING and 3 PRECEDING) as first from tmp tf)\n\nselect t.date, sum(new.c), sum(cr.c), sum(chr.c), sum(ar.c), sum(arr.c) from tmp t \n\nleft join (\n  select new.date as date, new.id as id, 1 as c from tmp_new new where new.first = 1\n) new on (new.date = t.date and new.id = t.id)\n\nleft join (\n  select tf.date as date, tf.id as id, 1 as c from tmp_cr tf where tf.first = 2\n) cr on (cr.date = t.date and cr.id = t.id)\n\nleft join (\n  select tf.date as date, tf.id as id, 1 as c from tmp_chr tf where tf.first = 2\n) chr on (chr.date = t.date and chr.id = t.id)\n\nleft join (\n  select tf.date as date, tf.id as id, 1 as c from tmp_ar tf where tf.first = 1\n) ar on (ar.date = t.date and ar.id = t.id)\n\nleft join (\n  select tf.date as date, tf.id as id, 1 as c from tmp_arr tf where tf.first <= 2\n) arr on (arr.date = t.date and arr.id = t.id)\n\nleft join (\n  select tf.date as date, tf.id as id, 1 as c from tmp_l tf where tf.first <= 1\n) l on (l.date = t.date and l.id = t.id)\n\ngroup by t.date","dateUpdated":"Apr 17, 2016 11:28:00 AM","dateFinished":"Apr 17, 2016 11:11:25 AM","dateStarted":"Apr 17, 2016 10:52:46 AM","result":{"code":"SUCCESS","type":"TABLE","msg":"t.date\t_c1\t_c2\t_c3\t_c4\t_c5\n2013-06-06\t95\tnull\tnull\t95\t95\n2013-06-07\t2\tnull\tnull\t2\t2\n2013-06-08\t1\t1\t1\t1\t2\n2013-06-09\tnull\tnull\tnull\tnull\tnull\n2013-06-10\t1\tnull\tnull\t1\t1\n","comment":"","msgTable":[[{"key":"_c1","value":"2013-06-06"},{"key":"_c1","value":"95"},{"key":"_c1","value":"null"},{"key":"_c1","value":"null"},{"key":"_c1","value":"95"},{"key":"_c1","value":"95"}],[{"key":"_c2","value":"2013-06-07"},{"key":"_c2","value":"2"},{"key":"_c2","value":"null"},{"key":"_c2","value":"null"},{"key":"_c2","value":"2"},{"key":"_c2","value":"2"}],[{"key":"_c3","value":"2013-06-08"},{"key":"_c3","value":"1"},{"key":"_c3","value":"1"},{"key":"_c3","value":"1"},{"key":"_c3","value":"1"},{"key":"_c3","value":"2"}],[{"key":"_c4","value":"2013-06-09"},{"key":"_c4","value":"null"},{"key":"_c4","value":"null"},{"key":"_c4","value":"null"},{"key":"_c4","value":"null"},{"key":"_c4","value":"null"}],[{"key":"_c5","value":"2013-06-10"},{"key":"_c5","value":"1"},{"key":"_c5","value":"null"},{"key":"_c5","value":"null"},{"key":"_c5","value":"1"},{"key":"_c5","value":"1"}]],"columnNames":[{"name":"t.date","index":0,"aggr":"sum"},{"name":"_c1","index":1,"aggr":"sum"},{"name":"_c2","index":2,"aggr":"sum"},{"name":"_c3","index":3,"aggr":"sum"},{"name":"_c4","index":4,"aggr":"sum"},{"name":"_c5","index":5,"aggr":"sum"}],"rows":[["2013-06-06","95","null","null","95","95"],["2013-06-07","2","null","null","2","2"],["2013-06-08","1","1","1","1","2"],["2013-06-09","null","null","null","null","null"],["2013-06-10","1","null","null","1","1"]]},"focus":true},{"config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1460915561778_454468689","id":"20160417-105241_2088608732","dateCreated":"Apr 17, 2016 10:52:41 AM","status":"READY","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:891"}],"name":"hive hw 1","id":"2BJPFZEWX","angularObjects":{"2BGZPBXN2":[],"2BKCXMDTM":[],"2BK4SQ1R4":[],"2BJNTBS46":[],"2BHXFGPD7":[],"2BJSNQQJQ":[],"2BGKYJ7RM":[],"2BGWVM81M":[],"2BJSCDQH7":[],"2BJW9BNYS":[],"2BG6M4BZY":[],"2BGEKRP35":[],"2BHE3VU67":[],"2BGY89STV":[],"2BHU5161W":[],"2BHYG3GZC":[],"2BHGSE6ZA":[],"2BHUYJVUK":[]},"config":{"looknfeel":"default"},"info":{}}